<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Actividad 3 - WebComponent con Tabla</title>
</head>
<body>
  <!-- Uso del WebComponent -->
  <solicitud-tabla></solicitud-tabla>

  <script>
    class SolicitudTabla extends HTMLElement {
      constructor() {
        super();

        // Creamos el Shadow DOM
        this.attachShadow({ mode: "open" });

        // Botón para efectuar la solicitud
        const button = document.createElement("button");
        button.textContent = "Efectuar Solicitud";

        // Contenedor donde pondremos la tabla
        const container = document.createElement("div");

        // Agregamos los elementos al shadow DOM
        this.shadowRoot.appendChild(button);
        this.shadowRoot.appendChild(container);

        // Evento click del botón
        button.addEventListener("click", async () => {
          try {
            // Realizamos la solicitud al endpoint
            const response = await fetch("https://jsonplaceholder.typicode.com/posts");

            if (!response.ok) {
              throw new Error("Error en la solicitud: " + response.status);
            }

            // Obtenemos los datos en formato JSON
            const data = await response.json();

            // Limpiamos el contenedor antes de agregar una nueva tabla
            container.innerHTML = "";

            // Creamos una tabla
            const table = document.createElement("table");
            table.border = "1"; // borde simple para ver la estructura

            // ---------- CABECERA DE LA TABLA ----------
            const headerRow = document.createElement("tr");

            // Definimos qué columnas mostrar
            const headers = ["ID", "UserID", "Title", "Body"];
            headers.forEach(h => {
              const th = document.createElement("th");
              th.textContent = h;
              headerRow.appendChild(th);
            });

            table.appendChild(headerRow);

            // ---------- FILAS DE LA TABLA ----------
            data.forEach(item => {
              const row = document.createElement("tr");

              // Agregamos cada campo como una celda
              const tdId = document.createElement("td");
              tdId.textContent = item.id;
              row.appendChild(tdId);

              const tdUserId = document.createElement("td");
              tdUserId.textContent = item.userId;
              row.appendChild(tdUserId);

              const tdTitle = document.createElement("td");
              tdTitle.textContent = item.title;
              row.appendChild(tdTitle);

              const tdBody = document.createElement("td");
              tdBody.textContent = item.body;
              row.appendChild(tdBody);

              table.appendChild(row);
            });

            // Insertamos la tabla en el contenedor
            container.appendChild(table);

          } catch (error) {
            container.innerHTML = `<p style="color:red;">${error.message}</p>`;
          }
        });
      }
    }

    // Registramos el WebComponent
    customElements.define("solicitud-tabla", SolicitudTabla);
  </script>
</body>
</html>