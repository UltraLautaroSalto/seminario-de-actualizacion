<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Actividad 2 - WebComponent con Fetch</title>
</head>
<body>
  <!-- Aquí usamos nuestro WebComponent -->
  <solicitud-component></solicitud-component>

  <script>
    // Definimos la clase del WebComponent
    class SolicitudComponent extends HTMLElement {
      constructor() {
        super(); // Llamamos al constructor de HTMLElement

        // Creamos un Shadow DOM para encapsular el componente
        this.attachShadow({ mode: "open" });

        // Creamos un botón
        const button = document.createElement("button");
        button.textContent = "Efectuar Solicitud"; 

        // Creamos el textarea donde se mostrará la respuesta
        const textarea = document.createElement("textarea");
        textarea.rows = 10;
        textarea.cols = 50;

        // Agregamos los elementos al shadow DOM
        this.shadowRoot.appendChild(button);
        this.shadowRoot.appendChild(document.createElement("br"));
        this.shadowRoot.appendChild(textarea);

        // Evento click sobre el botón
        button.addEventListener("click", async () => {
          try {
            // Hacemos la consulta usando fetch
            const response = await fetch("https://jsonplaceholder.typicode.com/posts/1");

            // Verificamos si la respuesta fue exitosa
            if (!response.ok) {
              throw new Error("Error en la solicitud: " + response.status);
            }

            // Convertimos la respuesta a texto plano (puede ser JSON también)
            const data = await response.text();

            // Insertamos la respuesta en el textarea
            textarea.value = data;
          } catch (error) {
            // Mostramos el error en el textarea
            textarea.value = error.message;
          }
        });
      }
    }

    // Registramos el WebComponent
    customElements.define("solicitud-component", SolicitudComponent);
  </script>
</body>
</html>