<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Actividad 4 - WebComponent con W3.CSS</title>
  <!-- Importamos la hoja de estilos de W3.CSS -->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>
<body>
  <!-- Uso del WebComponent -->
  <usuarios-tabla></usuarios-tabla>

  <script>
    class UsuariosTabla extends HTMLElement {
      constructor() {
        super();

        // Creamos el Shadow DOM
        this.attachShadow({ mode: "open" });

        // Importamos W3.CSS dentro del Shadow DOM
        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = "https://www.w3schools.com/w3css/4/w3.css";
        this.shadowRoot.appendChild(link);

        // Botón para efectuar la solicitud
        const button = document.createElement("button");
        button.textContent = "Efectuar Solicitud";
        button.className = "w3-button w3-blue w3-margin-bottom";

        // Contenedor de la tabla
        const container = document.createElement("div");

        // Agregamos al shadow DOM
        this.shadowRoot.appendChild(button);
        this.shadowRoot.appendChild(container);

        // Evento del botón
        button.addEventListener("click", async () => {
          try {
            const response = await fetch("https://jsonplaceholder.typicode.com/users/");
            if (!response.ok) {
              throw new Error("Error en la solicitud: " + response.status);
            }

            const data = await response.json();

            // Limpiamos contenedor
            container.innerHTML = "";

            // Creamos tabla con clases de W3.CSS
            const table = document.createElement("table");
            table.className = "w3-table w3-bordered w3-hoverable w3-card-4";

            // ---------- CABECERA ----------
            const headerRow = document.createElement("tr");
            headerRow.className = "w3-light-blue"; // color de fondo para el encabezado

            const headers = ["ID", "Usuario", "Nombre", "Correo", "Web", "Celular"];
            headers.forEach(h => {
              const th = document.createElement("th");
              th.textContent = h;
              headerRow.appendChild(th);
            });

            table.appendChild(headerRow);

            // ---------- FILAS DE DATOS ----------
            data.forEach(user => {
              const row = document.createElement("tr");

              // ID
              const tdId = document.createElement("td");
              tdId.textContent = user.id;
              row.appendChild(tdId);

              // Usuario (username)
              const tdUsername = document.createElement("td");
              tdUsername.textContent = user.username;
              row.appendChild(tdUsername);

              // Nombre (name)
              const tdName = document.createElement("td");
              tdName.textContent = user.name;
              row.appendChild(tdName);

              // Correo como "tag"
              const tdEmail = document.createElement("td");
              const emailTag = document.createElement("span");
              emailTag.className = "w3-tag w3-teal w3-round"; 
              emailTag.textContent = user.email;
              tdEmail.appendChild(emailTag);
              row.appendChild(tdEmail);

              // Web (website)
              const tdWeb = document.createElement("td");
              tdWeb.textContent = user.website;
              row.appendChild(tdWeb);

              // Celular (phone)
              const tdPhone = document.createElement("td");
              tdPhone.textContent = user.phone;
              row.appendChild(tdPhone);

              table.appendChild(row);
            });

            // Insertamos la tabla en el contenedor
            container.appendChild(table);

          } catch (error) {
            container.innerHTML = `<p class="w3-text-red">${error.message}</p>`;
          }
        });
      }
    }

    // Registramos el WebComponent
    customElements.define("usuarios-tabla", UsuariosTabla);
  </script>
</body>
</html>